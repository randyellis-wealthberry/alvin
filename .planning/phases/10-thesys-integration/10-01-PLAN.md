---
phase: 10-thesys-integration
plan: 01
type: execute
depends_on: []
files_modified:
  - package.json
  - src/components/chat/ChatInterface.tsx
  - src/components/chat/MessageList.tsx
---

<objective>
Integrate Thesys GenUI SDK into ALVIN chat for enhanced conversational UI rendering.

Purpose: Replace plain text message rendering with Thesys C1Component, enabling rich UI elements (cards, buttons, forms) in assistant responses. This enhances the wellness check-in experience with more engaging, interactive interfaces.

Output: ALVIN chat renders assistant messages using Thesys C1Component with proper theming and streaming support.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-alvin-chat/05-03-SUMMARY.md

@src/components/chat/ChatInterface.tsx
@src/components/chat/MessageList.tsx
@package.json

**Tech stack available:**
- AI SDK v6 with @ai-sdk/react useChat hook
- Next.js 15 App Router
- Tailwind CSS v4

**Established patterns:**
- useChat hook with DefaultChatTransport for streaming
- UIMessage with parts array for message content
- Status-based loading state (status === "streaming")

**From discovery:**
- Thesys GenUI SDK: `@thesysai/genui-sdk` + `@crayonai/react-ui`
- C1Component renders DSL responses from Thesys API
- ThemeProvider required at app level for styling
- Props: c1Response (string), isStreaming (boolean), onAction (callback)
- Import: `import "@crayonai/react-ui/styles/index.css"` for base styles

**Key insight:**
The current chat renders plain text. Thesys C1Component can render the same text BUT also supports rich UI when the LLM returns Thesys DSL format. This is a progressive enhancement—plain text still works, rich UI is a bonus.

**Note on API routing:**
For v1, we keep using the existing Claude API route. The C1Component will render text content gracefully. Full Thesys API routing (for generated UI) can be added later if desired.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Thesys GenUI SDK packages</name>
  <files>package.json</files>
  <action>
Install the Thesys GenUI SDK and its UI primitives dependency:
```bash
npm install @thesysai/genui-sdk @crayonai/react-ui
```

This adds the C1Component for rendering generative UI and the base styles/primitives.

Note: No THESYS_API_KEY is required for rendering—only for Thesys API routing (not in scope for this plan).
  </action>
  <verify>npm ls @thesysai/genui-sdk @crayonai/react-ui shows both packages installed</verify>
  <done>package.json includes @thesysai/genui-sdk and @crayonai/react-ui dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Add ThemeProvider wrapper and import styles</name>
  <files>src/components/chat/ChatInterface.tsx</files>
  <action>
Update ChatInterface.tsx to:

1. Import ThemeProvider and styles at the top:
```typescript
import { ThemeProvider } from "@thesysai/genui-sdk";
import "@crayonai/react-ui/styles/index.css";
```

2. Wrap the entire return content with ThemeProvider:
```tsx
return (
  <ThemeProvider>
    <div className="flex h-screen flex-col">
      {/* existing content */}
    </div>
  </ThemeProvider>
);
```

Keep all existing functionality intact—this is just adding the wrapper.

Note: The ThemeProvider provides CSS custom properties and design tokens used by C1Component.
  </action>
  <verify>npm run typecheck passes with no errors</verify>
  <done>ChatInterface wraps content in ThemeProvider and imports Thesys styles</done>
</task>

<task type="auto">
  <name>Task 3: Update MessageList to use C1Component for assistant messages</name>
  <files>src/components/chat/MessageList.tsx</files>
  <action>
Update MessageList.tsx to render assistant messages using C1Component:

1. Add imports at the top:
```typescript
import { C1Component } from "@thesysai/genui-sdk";
```

2. Accept isStreaming boolean for the current message (we'll derive from status):
The component already receives isLoading. We need to know if a specific message is currently streaming.

3. For assistant messages, replace the plain text span rendering with C1Component:

Before:
```tsx
{message.parts.map((part, i) =>
  part.type === "text" ? <span key={i}>{part.text}</span> : null,
)}
```

After (for assistant messages only):
```tsx
{message.role === "user" ? (
  // User messages remain plain text
  message.parts.map((part, i) =>
    part.type === "text" ? <span key={i}>{part.text}</span> : null,
  )
) : (
  // Assistant messages use C1Component
  <C1Component
    c1Response={message.parts
      .filter((p): p is { type: "text"; text: string } => p.type === "text")
      .map((p) => p.text)
      .join("")}
    isStreaming={isLoading && message === messages[messages.length - 1]}
  />
)}
```

4. Remove the redundant role-based outer div styling condition inside the map—
   the C1Component handles its own styling for assistant messages.

Keep user message styling as-is (blue bubble).

**Important:** The C1Component renders plain text gracefully when the response isn't Thesys DSL format. This is backward compatible.
  </action>
  <verify>
1. npm run typecheck passes
2. npm run build succeeds
  </verify>
  <done>
- Assistant messages render through C1Component
- User messages render as plain text bubbles
- Streaming state correctly passed to C1Component
- Build succeeds with no errors
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` passes
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes (or lint:fix if minor issues)
- [ ] Dev server starts without errors: `npm run dev`
- [ ] Chat page loads and existing conversations display correctly
</verification>

<success_criteria>

- All 3 tasks completed
- Thesys packages installed and importable
- ChatInterface wrapped with ThemeProvider
- MessageList uses C1Component for assistant messages
- User messages remain styled as blue bubbles
- Streaming indicator works correctly
- Existing chat functionality preserved
- No TypeScript or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-thesys-integration/10-01-SUMMARY.md`:

# Phase 10 Plan 01: Thesys GenUI Integration Summary

**[One-liner: what shipped]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `package.json` - Added Thesys dependencies
- `src/components/chat/ChatInterface.tsx` - ThemeProvider wrapper
- `src/components/chat/MessageList.tsx` - C1Component for assistant messages

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 10 complete, ready for next phase
</output>
