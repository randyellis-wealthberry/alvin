---
phase: 04-check-in-system
plan: 01
type: execute
depends_on: []
files_modified: [src/server/api/routers/checkin.ts, src/server/api/root.ts, src/app/check-in/page.tsx, src/app/check-in/check-in-button.tsx, src/app/check-in/check-in-history.tsx, src/app/page.tsx]
---

<objective>
Create explicit check-in flow for users to manually confirm wellness without requiring conversation.

Purpose: Users need a quick way to check in without engaging with ALVIN chat, especially when they just want to confirm they're okay.
Output: Check-in tRPC router and /check-in page with button and history display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-user-profile-management/02-01-SUMMARY.md
@.planning/phases/05-alvin-chat/05-03-SUMMARY.md

# Relevant source files:
@prisma/schema.prisma
@src/server/api/routers/profile.ts
@src/app/api/chat/route.ts
@src/lib/ai/check-in-detection.ts
@src/types/alvin.ts

**Tech stack available:** tRPC, Prisma, Next.js App Router, React Query
**Established patterns:**
- tRPC router with protected procedures (profile.ts pattern)
- SSR prefetch with HydrateClient
- Check-in recording updates lastCheckInAt on UserProfile

**Constraining decisions:**
- CheckIn model has method field: "MANUAL", "BIOMETRIC", "CONVERSATION"
- Conversation check-in already implemented (Phase 5-03)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checkIn tRPC router</name>
  <files>src/server/api/routers/checkin.ts, src/server/api/root.ts</files>
  <action>
Create checkIn router with:
- `record` mutation: Creates CheckIn with method="MANUAL", updates UserProfile.lastCheckInAt. Returns the created check-in.
- `list` query: Returns check-in history for current user's profile, ordered by performedAt DESC, limit 20.

Follow profile.ts patterns:
- Use protectedProcedure
- Get-or-create profile pattern (if profile missing, return appropriate error or empty array for list)
- No rate limiting needed for check-in (users should check in freely)

Register router in root.ts as `checkIn`.
  </action>
  <verify>npm run typecheck passes</verify>
  <done>checkIn.record and checkIn.list procedures work, router registered</done>
</task>

<task type="auto">
  <name>Task 2: Create check-in page with button and history</name>
  <files>src/app/check-in/page.tsx, src/app/check-in/check-in-button.tsx, src/app/check-in/check-in-history.tsx, src/app/page.tsx</files>
  <action>
Create /check-in route with:

**page.tsx** (Server Component):
- Protected route (redirect to / if not authenticated)
- SSR prefetch checkIn.list
- Render CheckInButton and CheckInHistory components

**check-in-button.tsx** (Client Component):
- Large prominent "I'm OK" button
- Uses checkIn.record mutation
- Shows success feedback (green checkmark + "Checked in!" message for 2 seconds)
- Invalidates checkIn.list after success
- Button disabled during mutation

**check-in-history.tsx** (Client Component):
- Uses checkIn.list query
- Displays recent check-ins with:
  - Relative time (e.g., "2 hours ago")
  - Method badge (Manual, Biometric, Conversation)
  - Date/time on hover or secondary text
- Shows "No check-ins yet" if empty
- Use simple table or list layout

**page.tsx** (home):
- Add "Check In" link to navigation for authenticated users (alongside Settings, Contacts, Chat)

Styling: Match existing app style with Tailwind classes.
  </action>
  <verify>npm run build passes, page accessible at /check-in</verify>
  <done>Check-in button works, history displays, navigation link added</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run typecheck` succeeds
- [ ] `npm run build` succeeds
- [ ] /check-in page loads for authenticated users
- [ ] "I'm OK" button creates check-in record
- [ ] Check-in history shows the new entry
- [ ] Navigation includes Check In link
</verification>

<success_criteria>

- Both tasks completed
- All verification checks pass
- Manual check-in creates record with method="MANUAL"
- lastCheckInAt updated on UserProfile
- Check-in history displays correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-check-in-system/04-01-SUMMARY.md`
</output>
