---
phase: 09-activity-dashboard
plan: 01
type: execute
depends_on: []
files_modified: [src/server/api/routers/dashboard.ts, src/server/api/root.ts, src/app/dashboard/page.tsx, src/app/dashboard/status-widget.tsx, src/app/dashboard/activity-log.tsx, src/app/page.tsx]
---

<objective>
Create activity dashboard showing check-in history, alert status, and unified activity log.

Purpose: Provide users with a central view of their ALVIN status - when they last checked in, when they need to check in next, any active alerts, and a timeline of recent activity.
Output: Dashboard page at /dashboard with status widgets and activity timeline, plus navigation link from home.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (for patterns):
@.planning/phases/04-check-in-system/04-01-SUMMARY.md
@.planning/phases/07-alert-escalation-engine/07-01-SUMMARY.md
@.planning/phases/08-contact-notifications/08-02-SUMMARY.md

# Existing routers to reuse/reference:
@src/server/api/routers/checkin.ts
@src/server/api/routers/alert.ts
@src/server/api/routers/conversation.ts

# UI patterns to follow:
@src/app/alerts/page.tsx
@src/app/check-in/check-in-history.tsx
@src/app/page.tsx

**Tech stack available:**
- tRPC with protectedProcedure pattern
- React Server Components with SSR prefetch
- Client components with "use client" directive
- useSuspenseQuery for data fetching
- Tailwind CSS with existing color scheme (purple gradient)

**Established patterns:**
- SSR auth redirect pattern (check session, redirect to signin if null)
- HydrateClient wrapper for prefetched queries
- formatRelativeTime for human-readable timestamps
- Color-coded badges for status (bg-blue-600, bg-purple-600, bg-green-600, etc.)
- Transaction pattern for atomic operations

**Constraining decisions:**
- Phase 7: Alert state machine (LEVEL_1-4, CANCELLED, RESOLVED)
- Phase 4: Check-in methods (MANUAL, BIOMETRIC, CONVERSATION)
- Phase 5: Conversation model with messages
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard tRPC router</name>
  <files>src/server/api/routers/dashboard.ts, src/server/api/root.ts</files>
  <action>
Create dashboard router with two procedures:

1. `getStatus` procedure:
   - Get user profile with lastCheckInAt and nextCheckInDue
   - Calculate time until next check-in due
   - Get active alert (if any) using ACTIVE_LEVELS from escalation.ts
   - Return: { lastCheckIn: Date | null, nextDue: Date | null, daysUntilDue: number | null, activeAlert: Alert | null, alertLevel: string | null }

2. `getActivityLog` procedure (input: { limit?: number, defaults to 20 }):
   - Query check-ins, alerts, and conversations for user profile
   - Transform into unified activity items with type, timestamp, description
   - Sort by timestamp descending
   - Return array: { id, type: 'check-in' | 'alert' | 'conversation', timestamp, description, metadata }

For check-ins: description = "Checked in via {method}"
For alerts: description = "Alert {level} triggered" or "Alert resolved/cancelled"
For conversations: description = "Conversation with ALVIN" (include message count)

Register dashboardRouter in root.ts.

Avoid creating duplicate logic - reuse ACTIVE_LEVELS from ~/lib/alerts/escalation and import calculateNextCheckInDue from ~/lib/reminders/eligibility if needed.
  </action>
  <verify>
npm run typecheck passes with no errors
  </verify>
  <done>
Dashboard router registered with getStatus and getActivityLog procedures, TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard page with widgets</name>
  <files>src/app/dashboard/page.tsx, src/app/dashboard/status-widget.tsx, src/app/dashboard/activity-log.tsx, src/app/page.tsx</files>
  <action>
Create dashboard UI with three components:

1. `page.tsx` (Server Component):
   - Auth check with redirect pattern (like alerts page)
   - Prefetch dashboard.getStatus and dashboard.getActivityLog
   - Render StatusWidget and ActivityLog with HydrateClient

2. `status-widget.tsx` (Client Component):
   - Display current status in a card layout:
     - Last check-in time (relative + absolute)
     - Next check-in due (relative, with color coding: green if >24h, yellow if <24h, red if overdue)
     - Active alert indicator (show level badge if active, "No active alerts" if none)
   - Quick action: Link to /check-in button if due soon or overdue

3. `activity-log.tsx` (Client Component):
   - Timeline display of recent activity
   - Icon per type: checkmark for check-in, warning for alert, chat bubble for conversation
   - Color-coded by type (follow existing badge pattern)
   - Show timestamp (relative) and description
   - "View all" link for each type (/check-in, /alerts, /chat)

4. Update `page.tsx` (home):
   - Add "Dashboard" link in the navigation area after "Check In"
   - Use same styling pattern as existing links

Follow existing Tailwind patterns:
- Container: bg-gradient-to-b from-[#2e026d] to-[#15162c] text-white
- Cards: bg-white/10 rounded-xl p-4
- Badges: rounded-full px-3 py-1 text-sm font-medium
  </action>
  <verify>
npm run typecheck passes
Visit /dashboard after npm run dev - page loads without errors
  </verify>
  <done>
Dashboard page renders with status widget and activity log, navigation link added to home page
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run typecheck` passes
- [ ] Dashboard router registered and accessible via tRPC
- [ ] /dashboard page loads with auth redirect
- [ ] Status widget shows last check-in, next due, alert status
- [ ] Activity log shows recent check-ins, alerts, conversations
- [ ] Dashboard link visible on home page for authenticated users
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Dashboard provides unified view of user's ALVIN status
- Activity log correctly aggregates check-ins, alerts, and conversations
- Phase 9 complete
</success_criteria>

<output>
After completion, create `.planning/phases/09-activity-dashboard/09-01-SUMMARY.md` following the standard summary template with frontmatter.
</output>
