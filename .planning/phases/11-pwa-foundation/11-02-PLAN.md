---
phase: 11-pwa-foundation
plan: 02
type: execute
depends_on: ["11-01"]
files_modified: [public/icon-192x192.png, public/icon-512x512.png, public/apple-touch-icon.png, src/app/offline/page.tsx, src/components/pwa/InstallPrompt.tsx, src/components/pwa/IOSInstallInstructions.tsx]
---

<objective>
Create PWA assets and install experience components.

Purpose: Complete the PWA with icons, offline fallback, and cross-platform install prompts.
Output: Fully functional PWA that can be installed on any device with proper offline handling.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-pwa-foundation/11-RESEARCH.md
@.planning/phases/11-pwa-foundation/11-01-SUMMARY.md

**Visual design (from landing page):**
- Background gradient: #2e026d (deep purple) to #15162c (dark navy)
- Accent color: #a855f7 (purple)
- Cards: bg-white/10 with 12px radius
- Text: white with 70% opacity for secondary

**Research findings for install prompts:**
- Chromium: Use beforeinstallprompt event
- iOS: No native prompt, show manual instructions
- Check standalone mode to avoid showing prompts when already installed
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PWA icons</name>
  <files>public/icon-192x192.png, public/icon-512x512.png, public/apple-touch-icon.png</files>
  <action>
    Create simple placeholder PNG icons for PWA. These are functional placeholders - proper branded icons should be designed later.

    Use Node.js canvas or a simple approach to generate solid purple (#2e026d) square icons with "A" letter:

    1. Create a simple script or use base64 data to generate icons:
       - 192x192 PNG: Purple background with white "A"
       - 512x512 PNG: Purple background with white "A"
       - 180x180 PNG (apple-touch-icon): Purple background with white "A"

    Alternative approach - create icons using sharp or canvas:
    ```bash
    # If sharp is available, or use online tool
    # For now, create simple solid color PNGs
    ```

    If programmatic generation is complex, create minimal valid PNG files with the purple brand color (#2e026d). The key is having valid PNG files at the right sizes that the manifest references.

    Note: For production, use https://realfavicongenerator.net/ or similar to create proper icon set from a designed logo.
  </action>
  <verify>ls -la public/*.png shows all three icon files exist; file public/icon-192x192.png confirms PNG format</verify>
  <done>PWA icons exist at correct paths and sizes, manifest can reference them</done>
</task>

<task type="auto">
  <name>Task 2: Create offline fallback page</name>
  <files>src/app/offline/page.tsx</files>
  <action>
    Create src/app/offline/page.tsx with ALVIN-branded offline experience:

    ```typescript
    import type { Metadata } from "next";

    export const metadata: Metadata = {
      title: "Offline",
    };

    export default function OfflinePage() {
      return (
        <main className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-[#2e026d] to-[#15162c] px-4 text-white">
          <div className="flex flex-col items-center gap-6 text-center">
            {/* Offline icon */}
            <div className="rounded-full bg-white/10 p-6">
              <svg
                className="h-16 w-16 text-white/70"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={1.5}
                  d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a5 5 0 01-1.414-3.536m1.414 3.536l-2.829 2.829M3 3l18 18"
                />
              </svg>
            </div>

            {/* Title */}
            <h1 className="text-4xl font-extrabold tracking-tight">
              You&apos;re Offline
            </h1>

            {/* Message */}
            <p className="max-w-md text-lg text-white/70">
              ALVIN needs an internet connection to check in and monitor your
              wellness. Please reconnect to continue.
            </p>

            {/* Retry button */}
            <button
              onClick={() => window.location.reload()}
              className="mt-4 rounded-full bg-[#a855f7] px-8 py-3 font-semibold text-white transition hover:bg-[#9333ea]"
            >
              Try Again
            </button>

            {/* Tip */}
            <p className="mt-8 text-sm text-white/50">
              Tip: Your check-in history is cached for offline viewing
            </p>
          </div>
        </main>
      );
    }
    ```

    Note: This is a server component by default. The onClick needs client-side hydration.
    Add "use client"; at the top to enable the button interactivity.
  </action>
  <verify>npm run build succeeds; the /offline route is accessible</verify>
  <done>Offline page displays ALVIN-branded message with retry functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create install prompt components</name>
  <files>src/components/pwa/InstallPrompt.tsx, src/components/pwa/IOSInstallInstructions.tsx, src/app/layout.tsx</files>
  <action>
    1. Create src/components/pwa/ directory

    2. Create src/components/pwa/InstallPrompt.tsx for Chromium browsers:
       ```typescript
       "use client";

       import { useEffect, useState } from "react";

       interface BeforeInstallPromptEvent extends Event {
         prompt: () => Promise<void>;
         userChoice: Promise<{ outcome: "accepted" | "dismissed" }>;
       }

       export function InstallPrompt() {
         const [deferredPrompt, setDeferredPrompt] =
           useState<BeforeInstallPromptEvent | null>(null);
         const [isVisible, setIsVisible] = useState(false);

         useEffect(() => {
           const handler = (e: Event) => {
             e.preventDefault();
             setDeferredPrompt(e as BeforeInstallPromptEvent);
             setIsVisible(true);
           };

           window.addEventListener("beforeinstallprompt", handler);
           return () => window.removeEventListener("beforeinstallprompt", handler);
         }, []);

         const handleInstall = async () => {
           if (!deferredPrompt) return;
           await deferredPrompt.prompt();
           const { outcome } = await deferredPrompt.userChoice;
           if (outcome === "accepted") {
             setIsVisible(false);
             setDeferredPrompt(null);
           }
         };

         const handleDismiss = () => {
           setIsVisible(false);
         };

         if (!isVisible) return null;

         return (
           <div className="fixed bottom-4 left-4 right-4 z-50 mx-auto max-w-md rounded-xl bg-white/10 p-4 backdrop-blur-lg">
             <div className="flex items-center justify-between gap-4">
               <div className="flex-1">
                 <p className="font-semibold text-white">Install ALVIN</p>
                 <p className="text-sm text-white/70">
                   Add to your home screen for quick access
                 </p>
               </div>
               <div className="flex gap-2">
                 <button
                   onClick={handleDismiss}
                   className="rounded-lg px-3 py-2 text-sm text-white/70 hover:text-white"
                 >
                   Later
                 </button>
                 <button
                   onClick={handleInstall}
                   className="rounded-lg bg-[#a855f7] px-4 py-2 text-sm font-semibold text-white hover:bg-[#9333ea]"
                 >
                   Install
                 </button>
               </div>
             </div>
           </div>
         );
       }
       ```

    3. Create src/components/pwa/IOSInstallInstructions.tsx for Safari:
       ```typescript
       "use client";

       import { useEffect, useState } from "react";

       function isIOS(): boolean {
         if (typeof navigator === "undefined") return false;
         return /iPad|iPhone|iPod/.test(navigator.userAgent);
       }

       function isInStandaloneMode(): boolean {
         if (typeof window === "undefined") return false;
         return (
           "standalone" in window.navigator &&
           (window.navigator as Navigator & { standalone?: boolean }).standalone === true
         );
       }

       export function IOSInstallInstructions() {
         const [showBanner, setShowBanner] = useState(false);

         useEffect(() => {
           // Only show on iOS Safari when not already installed
           if (isIOS() && !isInStandaloneMode()) {
             // Check if user dismissed before (localStorage)
             const dismissed = localStorage.getItem("ios-install-dismissed");
             if (!dismissed) {
               setShowBanner(true);
             }
           }
         }, []);

         const handleDismiss = () => {
           localStorage.setItem("ios-install-dismissed", "true");
           setShowBanner(false);
         };

         if (!showBanner) return null;

         return (
           <div className="fixed bottom-4 left-4 right-4 z-50 mx-auto max-w-md rounded-xl bg-white/10 p-4 backdrop-blur-lg">
             <div className="flex items-start gap-3">
               <div className="flex-1">
                 <p className="font-semibold text-white">Install ALVIN</p>
                 <p className="mt-1 text-sm text-white/70">
                   Tap{" "}
                   <span className="inline-flex items-center">
                     <svg
                       className="mx-1 h-4 w-4"
                       fill="none"
                       stroke="currentColor"
                       viewBox="0 0 24 24"
                     >
                       <path
                         strokeLinecap="round"
                         strokeLinejoin="round"
                         strokeWidth={2}
                         d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"
                       />
                     </svg>
                   </span>{" "}
                   then &quot;Add to Home Screen&quot;
                 </p>
               </div>
               <button
                 onClick={handleDismiss}
                 className="rounded-lg p-1 text-white/70 hover:text-white"
                 aria-label="Dismiss"
               >
                 <svg className="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path
                     strokeLinecap="round"
                     strokeLinejoin="round"
                     strokeWidth={2}
                     d="M6 18L18 6M6 6l12 12"
                   />
                 </svg>
               </button>
             </div>
           </div>
         );
       }
       ```

    4. Create src/components/pwa/index.ts barrel export:
       ```typescript
       export { InstallPrompt } from "./InstallPrompt";
       export { IOSInstallInstructions } from "./IOSInstallInstructions";
       ```

    5. Add install prompts to src/app/layout.tsx:
       - Import both components
       - Add them inside the body, after TRPCReactProvider

       ```typescript
       import { InstallPrompt, IOSInstallInstructions } from "~/components/pwa";

       // In the body:
       <TRPCReactProvider>{children}</TRPCReactProvider>
       <InstallPrompt />
       <IOSInstallInstructions />
       ```
  </action>
  <verify>npm run build succeeds; npm run typecheck passes</verify>
  <done>Install prompts work on Chromium (native) and iOS (manual instructions), integrated into layout</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] All three PWA icons exist in public/
- [ ] `/offline` page renders correctly
- [ ] `npm run typecheck` passes
- [ ] Install prompt components are in layout
</verification>

<success_criteria>
- All tasks completed
- PWA icons exist at correct paths
- Offline page has ALVIN branding and retry button
- Install prompts show appropriately (Chromium native, iOS manual)
- Phase 11 complete: PWA installable with offline support
</success_criteria>

<output>
After completion, create `.planning/phases/11-pwa-foundation/11-02-SUMMARY.md`
</output>
