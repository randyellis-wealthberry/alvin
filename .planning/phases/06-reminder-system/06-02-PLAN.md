---
phase: 06-reminder-system
plan: 02
type: execute
depends_on: ["06-01"]
files_modified: [package.json, src/emails/ReminderEmail.tsx, src/app/api/cron/reminders/route.ts, src/env.js]
---

<objective>
Integrate Resend email service and create reminder email templates.

Purpose: Enable the cron job to send actual reminder emails to users who need to check in.
Output: Working reminder email flow that sends personalized emails via Resend.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-reminder-system/06-01-SUMMARY.md

**Key source files:**
@src/app/api/cron/reminders/route.ts
@src/lib/reminders/eligibility.ts
@src/env.js

**Discovery findings (from plan-phase):**
- Resend: npm install resend @react-email/components
- Use RESEND_API_KEY environment variable
- Send with React email templates
- From address: Use resend.dev domain for testing, custom domain for production

**Patterns from prior phases:**
- Environment validation via @t3-oss/env-nextjs in src/env.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Resend and create email template</name>
  <files>package.json, src/emails/ReminderEmail.tsx</files>
  <action>
1. Install dependencies:
   npm install resend @react-email/components

2. Create src/emails/ReminderEmail.tsx:
   - Import from @react-email/components (Html, Head, Body, Container, Text, Button, etc.)
   - Props interface: { userName: string; checkInUrl: string; lastCheckIn: string }
   - Design a simple, friendly reminder email:
     - Subject line suggestion: "Time for your ALVIN check-in"
     - Greeting with user name
     - Friendly reminder message
     - CTA button linking to check-in page
     - Note about why they're receiving this

Keep the template simple and professional. No emojis.
Use inline styles (required for email clients).
  </action>
  <verify>npm run typecheck passes</verify>
  <done>ReminderEmail component created with proper types and styling</done>
</task>

<task type="auto">
  <name>Task 2: Wire up email sending in cron endpoint</name>
  <files>src/app/api/cron/reminders/route.ts</files>
  <action>
Update the cron endpoint to send actual emails:

1. Import Resend and ReminderEmail template
2. Initialize Resend client with env.RESEND_API_KEY
3. For each user needing a reminder:
   - Send email using resend.emails.send()
   - From: "ALVIN <onboarding@resend.dev>" (use resend.dev for testing)
   - To: user email
   - Subject: "Time for your ALVIN check-in"
   - React: ReminderEmail component with props
4. Track successes and failures
5. Return summary in response: { sent: number, failed: number, errors: string[] }

Error handling:
- Catch individual email failures, don't let one failure stop others
- Log errors for debugging
- Continue processing remaining users

Do NOT update lastCheckInAt or nextCheckInDue here - that happens on actual check-in.
  </action>
  <verify>
With RESEND_API_KEY set, endpoint sends test email when user is due for reminder.
Check Resend dashboard for sent emails.
  </verify>
  <done>Cron endpoint sends reminder emails to eligible users, reports success/failure counts</done>
</task>

<task type="auto">
  <name>Task 3: Add RESEND_API_KEY to environment config</name>
  <files>src/env.js</files>
  <action>
Update src/env.js to include RESEND_API_KEY:

1. Add to server schema:
   RESEND_API_KEY: z.string().min(1),

2. Add to runtimeEnv:
   RESEND_API_KEY: process.env.RESEND_API_KEY,

3. Update .env.example (if exists) or document in code comment:
   # RESEND_API_KEY - Get from https://resend.com/api-keys

Note: RESEND_API_KEY is required. For local development, users need to:
1. Sign up at resend.com
2. Get API key from dashboard
3. Add to .env file
  </action>
  <verify>npm run typecheck passes, app starts without env validation errors when RESEND_API_KEY is set</verify>
  <done>RESEND_API_KEY added to environment schema and validated at startup</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run typecheck passes
- [ ] npm run lint passes
- [ ] npm run build succeeds
- [ ] ReminderEmail template renders correctly (can test with @react-email/render)
- [ ] Cron endpoint sends emails when triggered with valid auth
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Reminder emails sent to users who are overdue for check-in
- Email template is professional and includes check-in CTA
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-reminder-system/06-02-SUMMARY.md`
</output>
